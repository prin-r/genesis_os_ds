#!/usr/bin/env python3

import sys
import json
import requests

HEADERS = {"Content-Type": "application/json"}

SYMBOLS_WITH_WEIGHTS = [
    ["BTC", 0.006409578143110376],
    ["ETH", 0.08951124093070151],
    ["DOT", 1.8461591119851968],
    ["BNB", 0.09325735284087658],
    ["EOS", 7.6142527848218835],
    ["XTZ", 10.229778972777034],
    ["YFI", 0.000935972555183083],
    ["ATOM", 2.4695606356548736],
    ["UNI", 0.4208089290937524],
    ["FIL", 0.17586374723940587],
    ["BCH", 0.016759352857710984],
    ["TRX", 143.2346403144306],
    ["HT", 0.8420468156009022],
    ["SXP", 4.245144402386687],
    ["OKB", 0.47169589135343554],
    ["ZIL", 109.43976611928932],
    ["XLM", 32.189468776224075],
    ["CRO", 70.7412172869226],
    ["LINK", 0.4032846167190981],
    ["ADA", 6.938864394580486],
    ["OMG", 2.049515457033305],
    ["SNX", 0.9041314225426578],
    ["ALGO", 10.909777904090475],
    ["COMP", 0.022630710821985537],
    ["NEO", 0.16624438177267478],
    ["BAT", 11.715072178322144],
    ["AAVE", 0.023041819265296398],
    ["VET", 85.08783478368217],
    ["THETA", 1.2496495159779262],
    ["SUSHI", 0.8621398107578373],
    ["LTC", 0.05263843470389099],
    ["KNC", 5.224804646218248],
    ["XRP", 10.201662381438823],
    ["MVL", 549.998110474162],
    ["BTT", 2679.115065594349],
    ["MKR", 0.0025534095475422086],
    ["ZRX", 9.352118706966426],
    ["CELO", 2.7497770081914203],
    ["DOGE", 53.37290798087214],
    ["FTT", 0.31473685009848573],
    ["REN", 25.225842157620264],
    ["MTL", 4.8249342336656],
    ["SRM", 2.74578221863267],
    ["QTUM", 1.3850138279942925],
    ["DGB", 72.4081311519898],
    ["ONT", 3.8907135847316052],
    ["ICX", 3.327007462592199],
    ["LINA", 81.76831084275032],
    ["KSM", 0.016818127566247038],
    ["XEM", 18.955558189045348],
    ["UMA", 0.3673216824003579],
    ["MIOTA", 3.589885187951157],
]


def main(url):
    symbols, weights = zip(*SYMBOLS_WITH_WEIGHTS)
    result = requests.get(
        url,
        params={"symbols": symbols, "min_count": 10, "ask_count": 16},
    ).json()

    prices = [float(px["px"]) / float(px["multiplier"]) for px in result["price_results"]]
    acc = 0
    for (p, w) in zip(prices, weights):
        acc += float(p) * w
    return acc


if __name__ == "__main__":
    try:
        print(main(*sys.argv[1:]))
    except Exception as e:
        print(str(e), file=sys.stderr)
        sys.exit(1)
