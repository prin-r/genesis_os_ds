#!/usr/bin/env python3

import sys
import json
import requests

HEADERS = {"Content-Type": "application/json"}

SYMBOLS_WITH_WEIGHTS = [
    ["BTC", 0.7176566276488755],
    ["ETH", 0.12783491441496697],
    ["BNB", 0.026867214378103563],
    ["ADA", 0.02266340942603336],
    ["DOT", 0.01907061068058649],
    ["XRP", 0.012371810449095336],
    ["LTC", 0.0075716543245295444],
    ["LINK", 0.006677686690916358],
    ["BCH", 0.006536934155674898],
    ["XLM", 0.005835422381379173],
    ["DOGE", 0.0033045043657054306],
    ["XEM", 0.002431272257762697],
    ["AAVE", 0.0027417623543425362],
    ["CRO", 0.0025643633483692627],
    ["ATOM", 0.002696273743018537],
    ["EOS", 0.002541685005299959],
    ["TRX", 0.00227481134162368],
    ["HT", 0.0021689488268068885],
    ["MIOTA", 0.001620031449440698],
    ["THETA", 0.0019200413255576559],
    ["NEO", 0.0017667871098567553],
    ["FTT", 0.001622676291117408],
    ["XTZ", 0.0018326742759335744],
    ["VET", 0.0016536532784164769],
    ["SNX", 0.0014002760964577346],
    ["MKR", 0.001269343235481094],
    ["ALGO", 0.001311262595798778],
    ["LEO", 0.0012361362307553715],
    ["KSM", 0.0010459908221243882],
    ["COMP", 0.0012178161460254073],
    ["BTT", 0.0008064372083730404],
    # ["ZIL", 0.0008159975394270052],
    ["YFI", 0.0008353463218346979],
    ["UMA", 0.0006015035106494092],
    ["REN", 0.0006429327137998384],
    ["ZRX", 0.0006611052304243434],
    ["OKB", 0.0006919788931367003],
    ["ICX", 0.0005063582033419916],
    ["DGB", 0.0004407449253433441],
    ["ONT", 0.00042440731235062124],
    # ["CELO", 0.00046986373105565584],
    ["BAT", 0.00046925773629645756],
    ["OMG", 0.00042405230385051225],
    ["QTUM", 0.00028964341201573324],
    ["KNC", 0.00021377630804507282],
]


def main(url):
    symbols, weights = zip(*SYMBOLS_WITH_WEIGHTS)
    payload = {"symbols": symbols, "min_count": 10, "ask_count": 16}
    result = requests.request("POST", url, headers=HEADERS, json=payload).json()
    prices = [float(px["px"]) / float(px["multiplier"]) for px in result["result"]]
    acc = 0
    for (p, w) in zip(prices, weights):
        acc += float(p) * w
    return acc


if __name__ == "__main__":
    try:
        print(main(*sys.argv[1:]))
    except Exception as e:
        print(str(e), file=sys.stderr)
        sys.exit(1)
