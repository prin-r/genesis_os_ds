#!/usr/bin/env python3

import sys
import json
import requests

HEADERS = {"Content-Type": "application/json"}

SYMBOLS_WITH_WEIGHTS = [
    ["BTC", 0.010237866608343742],
    ["ETH", 0.05756151662734858],
    ["BNB", 0.0816852436468387],
    ["ADA", 14.59685012545764],
    ["XRP", 20.370370514383648],
    ["DOGE", 54.64613440648699],
    ["DOT", 0.45844202201128387],
    ["UNI", 0.2566379677473105],
    ["BCH", 0.009012756061825545],
    ["LTC", 0.028949547579771258],
    ["LINK", 0.17632155841676142],
    ["XLM", 10.613482873928291],
    ["THETA", 0.444700214946588],
    ["VET", 27.001256124037887],
    ["FIL", 0.042441584873379436],
    ["TRX", 33.683677593902765],
    ["AAVE", 0.005546396741461094],
    ["EOS", 0.4684210529845217],
    ["CRO", 11.505584029765705],
    ["FTT", 0.037042633002657095],
    ["MKR", 0.0004207211381750718],
    ["ALGO", 1.4734850843056913],
    ["ATOM", 0.10078763616093385],
    ["NEO", 0.0247154583286898],
    ["XTZ", 0.3989682111715177],
    ["MIOTA", 0.9379594027479111],
    ["COMP", 0.0024360456861454317],
    ["BTT", 286.12361016187486],
    ["HT", 0.0813974409052745],
    ["KSM", 0.0030991899512752084],
    ["XEM", 3.231201345509343],
    ["SNX", 0.0519076288903307],
    ["YFI", 1.6964671105723187e-05],
    ["OKB", 0.026710647425863626],
    ["SUSHI", 0.052127333662507706],
    ["BAT", 0.6210391764024272],
    ["ZIL", 4.962173912359314],
    ["CELO", 0.11478959944584209],
    ["QTUM", 0.0333149188143337],
    ["ONT", 0.29600297535153747],
    ["DGB", 5.480414402827529],
    ["ZRX", 0.34254574966115436],
    ["ICX", 0.23261091379239937],
    ["OMG", 0.06010297128880104],
    ["UMA", 0.02306504593516511],
    ["REN", 0.3609790591814346],
    ["KNC", 0.09492310437489856],
    ["SXP", 0.0468417612129386],
    ["SRM", 0.01776073231734838],
    ["MVL", 5.1898620128450474],
]


def main(url):
    symbols, weights = zip(*SYMBOLS_WITH_WEIGHTS)
    result = requests.get(
        url,
        params={"symbols": symbols, "min_count": 10, "ask_count": 16},
    ).json()
    prices = [float(px["px"]) / float(px["multiplier"]) for px in result["price_results"]]
    acc = 0
    for (p, w) in zip(prices, weights):
        acc += float(p) * w
    return acc


if __name__ == "__main__":
    try:
        print(main(*sys.argv[1:]))
    except Exception as e:
        print(str(e), file=sys.stderr)
        sys.exit(1)
